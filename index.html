<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spin Wheel</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      background: #f4f4f9;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    h1 {
      margin-bottom: 10px;
    }
    canvas {
      border: 5px solid #333;
      border-radius: 50%;
      background: white;
    }
    .buttons {
      margin-top: 20px;
      display: flex;
      gap: 15px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 10px;
      background: #4CAF50;
      color: white;
      transition: background 0.3s;
    }
    button:hover:not(:disabled) {
      background: #45a049;
    }
    button:disabled {
      background: gray;
      cursor: not-allowed;
    }
    .history {
      margin-top: 30px;
      text-align: center;
    }
    .history ul {
      list-style-type: none;
      padding: 0;
    }
    .history li {
      background: #ddd;
      margin: 5px 0;
      padding: 5px 10px;
      border-radius: 6px;
    }
    .segments-left {
      margin-top: 15px;
      font-size: 18px;
      color: #333;
    }
    .debug {
      margin-top: 10px;
      font-size: 12px;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>Click to Spin!</h1>
  <canvas id="wheel" width="400" height="400"></canvas>
  
  <div class="segments-left">
    Segments remaining: <span id="segmentCount">6</span>
  </div>
  
  <div class="buttons">
    <button id="spinBtn" onclick="spin()">Spin Wheel</button>
    <button id="resetBtn" onclick="resetWheel()">Reset Wheel</button>
  </div>

  <div class="history">
    <h2>Last 5 Results</h2>
    <ul id="historyList"></ul>
  </div>

  <div class="debug">
    Status: <span id="debugStatus">Ready to spin</span>
  </div>

  <script>
    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");

    // Original items with their corresponding colors
    const originalSegments = [
      { text: "Prize 1", color: "#FF6F61" },
      { text: "Prize 2", color: "#6B5B95" },
      { text: "Prize 3", color: "#88B04B" },
      { text: "Prize 4", color: "#F7CAC9" },
      { text: "Prize 5", color: "#92A8D1" },
      { text: "Prize 6", color: "#955251" }
    ];

    let segments = JSON.parse(JSON.stringify(originalSegments)); // Deep copy
    let currentAngle = 0;
    let isSpinning = false;
    let history = [];
    let animationId = null;

    function updateDebugStatus(status) {
      document.getElementById("debugStatus").textContent = status;
    }

    function drawWheel() {
      const centerX = 200;
      const centerY = 200;
      const radius = 180;
      const textRadius = 130;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (segments.length === 0) {
        // Draw empty wheel
        ctx.fillStyle = "#ddd";
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.fillStyle = "#666";
        ctx.font = "20px Arial";
        ctx.textAlign = "center";
        ctx.fillText("All Done!", centerX, centerY);
        ctx.textAlign = "start";
        return;
      }

      const segmentAngle = (Math.PI * 2) / segments.length;

      // Draw segments
      for (let i = 0; i < segments.length; i++) {
        const startAngle = currentAngle + (i * segmentAngle);
        const endAngle = startAngle + segmentAngle;

        // Draw segment
        ctx.fillStyle = segments[i].color;
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, startAngle, endAngle);
        ctx.closePath();
        ctx.fill();

        // Draw border
        ctx.strokeStyle = "#fff";
        ctx.lineWidth = 2;
        ctx.stroke();

        // Draw text
        const textAngle = startAngle + segmentAngle / 2;
        const textX = centerX + Math.cos(textAngle) * textRadius;
        const textY = centerY + Math.sin(textAngle) * textRadius;

        ctx.save();
        ctx.translate(textX, textY);
        ctx.rotate(textAngle + Math.PI / 2);
        ctx.fillStyle = "white";
        ctx.font = "16px Arial";
        ctx.textAlign = "center";
        ctx.fillText(segments[i].text, 0, 0);
        ctx.restore();
      }

      // Draw pointer
      ctx.fillStyle = "black";
      ctx.beginPath();
      ctx.moveTo(centerX - 10, 30);
      ctx.lineTo(centerX + 10, 30);
      ctx.lineTo(centerX, 60);
      ctx.closePath();
      ctx.fill();
    }

    function getSelectedSegment() {
      if (segments.length === 0) return null;
      
      // The pointer points down, so we need to find which segment is at the top
      const normalizedAngle = (((-currentAngle) % (Math.PI * 2)) + (Math.PI * 2)) % (Math.PI * 2);
      const segmentAngle = (Math.PI * 2) / segments.length;
      const selectedIndex = Math.floor(normalizedAngle / segmentAngle);
      
      return segments[selectedIndex];
    }

    function spin() {
      if (isSpinning || segments.length === 0) {
        updateDebugStatus("Cannot spin right now");
        return;
      }

      updateDebugStatus("Spinning...");
      isSpinning = true;
      
      // Random spin amount (multiple full rotations plus some extra)
      const minSpins = 5; // minimum full rotations
      const maxSpins = 10; // maximum full rotations
      const spins = minSpins + Math.random() * (maxSpins - minSpins);
      const finalAngle = spins * Math.PI * 2;
      
      const startTime = Date.now();
      const duration = 3000; // 3 seconds
      const startAngle = currentAngle;
      
      function animate() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        // Easing function for smooth deceleration
        const easeOut = 1 - Math.pow(1 - progress, 3);
        
        currentAngle = startAngle + finalAngle * easeOut;
        drawWheel();
        
        if (progress < 1) {
          animationId = requestAnimationFrame(animate);
        } else {
          // Spinning finished
          isSpinning = false;
          const selected = getSelectedSegment();
          
          if (selected) {
            updateDebugStatus("Spin complete!");
            
            // Add to history
            history.unshift(selected.text);
            if (history.length > 5) {
              history.pop();
            }
            updateHistory();
            
            // Remove selected segment
            const selectedIndex = segments.indexOf(selected);
            if (selectedIndex > -1) {
              segments.splice(selectedIndex, 1);
            }
            
            updateSegmentCount();
            
            // Show result
            setTimeout(() => {
              alert("You got: " + selected.text);
              
              if (segments.length === 0) {
                alert("All prizes have been chosen! ðŸŽ‰");
                document.getElementById("spinBtn").disabled = true;
                updateDebugStatus("All done!");
              } else {
                updateDebugStatus("Ready to spin again");
              }
              
              drawWheel();
            }, 100);
          }
        }
      }
      
      animate();
    }

    function updateHistory() {
      const historyList = document.getElementById("historyList");
      historyList.innerHTML = "";
      history.forEach((item, index) => {
        const li = document.createElement("li");
        li.textContent = `${index + 1}. ${item}`;
        historyList.appendChild(li);
      });
    }

    function updateSegmentCount() {
      document.getElementById("segmentCount").textContent = segments.length;
    }

    function resetWheel() {
      if (animationId) {
        cancelAnimationFrame(animationId);
      }
      
      segments = JSON.parse(JSON.stringify(originalSegments));
      history = [];
      currentAngle = 0;
      isSpinning = false;
      
      document.getElementById("spinBtn").disabled = false;
      updateHistory();
      updateSegmentCount();
      updateDebugStatus("Ready to spin");
      drawWheel();
    }

    // Initialize
    drawWheel();
    updateHistory();
    updateDebugStatus("Ready to spin");
  </script>
</body>
</html>
