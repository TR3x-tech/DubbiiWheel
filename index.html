<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spin Wheel</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      background: #f4f4f9;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    h1 { margin-bottom: 10px; }
    canvas {
      border: 5px solid #333;
      border-radius: 50%;
      background: white;
    }
    .buttons {
      margin-top: 20px;
      display: flex;
      gap: 15px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 10px;
      background: #4CAF50;
      color: white;
      transition: background 0.3s;
    }
    button:hover:not(:disabled) { background: #45a049; }
    button:disabled {
      background: gray;
      cursor: not-allowed;
    }
    .history { margin-top: 30px; text-align: center; }
    .history ul { list-style-type: none; padding: 0; }
    .history li {
      background: #ddd;
      margin: 5px 0;
      padding: 5px 10px;
      border-radius: 6px;
    }
    .segments-left {
      margin-top: 15px;
      font-size: 18px;
      color: #333;
    }
    .debug { margin-top: 10px; font-size: 12px; color: #666; }
  </style>
</head>
<body>
  <h1>Click to Spin for the Parade!!</h1>
  <canvas id="wheel" width="500" height="500"></canvas>

  <div class="segments-left">
    Segments remaining: <span id="segmentCount">6</span>
  </div>

  <div class="buttons">
    <button id="spinBtn" onclick="spin()">Spin Wheel</button>
    <button id="resetBtn" onclick="resetWheel()">Reset Wheel</button>
  </div>

  <div class="history">
    <h2>Last 5 Results</h2>
    <ul id="historyList"></ul>
  </div>

  <div class="lists-container">
  <div class="list">
    <h2>Remaining</h2>
    <ul id="remainingList"></ul>
  </div>
  <div class="list">
    <h2>Spun</h2>
    <ul id="spunList"></ul>
  </div>
</div>

<div class="list-controls">
  <button onclick="moveSelected('toSpun')">‚Üí Mark as Spun</button>
  <button onclick="moveSelected('toRemaining')">‚Üê Add Back</button>
  <button onclick="removePermanently()">‚ùå Remove Permanently</button>
</div>

<!-- New revert button at very bottom -->
<div style="margin-top:20px;">
  <button onclick="revertOriginal()" style="background:#d9534f;">‚Ü© Revert Wheel to Original State</button>
</div>

 <div style="margin-top: 30px; padding: 15px; border: 2px solid #ccc; border-radius: 10px; background: #f9f9f9; width: 90%; max-width: 600px;">
  <h3>Add New Item to Wheel</h3>
  <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items:center;">
    <input type="text" id="newText" placeholder="Item Text" style="flex:2; padding:5px;" />
    <input type="text" id="newEmoji" placeholder="Emoji" style="flex:1; padding:5px;" />
    <input type="color" id="newColor" value="#FF0000" style="flex:1; padding:5px;" />
    <button id="addItemBtn" style="flex:1; background:#4CAF50; color:white;">Add Item</button>
  </div>
</div>



<style>
  canvas {
    border: 10px solid #333; /* visible border */
    border-radius: 50%;      /* circular border */
    background: transparent; /* let wheel drawing show fully */
  }
  .lists-container {
  display: flex;
  justify-content: space-between;
  width: 90%;
  margin-top: 30px;
}

.list {
  flex: 1;
  margin: 0 20px;
  background: #f9f9f9;
  border: 2px solid #ccc;
  border-radius: 10px;
  padding: 15px;
  max-height: 300px;
  overflow-y: auto;
}

.list h2 {
  text-align: center;
  margin-bottom: 10px;
}

.list ul {
  list-style: none;
  padding: 0;
}

.list li {
  padding: 5px;
  margin: 4px 0;
  background: #eee;
  border-radius: 5px;
  cursor: pointer;
}

.list li.selected {
  background: #4CAF50;
  color: white;
}
.list-controls {
  margin-top: 10px;
  display: flex;
  gap: 15px;
  justify-content: center;
}

</style>


  
  <div class="debug">
    Status: <span id="debugStatus">Ready to spin</span>
  </div>

  <script>
    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");

    // Original wheel segments
    const originalSegments = [
      { text: "Arts/Crafts", color: "#FF6F61" , emoji: "üé®"},
      { text: "Food/Beverage", color: "#6B5B95", emoji: "ü´ï" },
      { text: "Lego/Puzzle", color: "#88B04B", emoji: "üß©" },
      { text: "Collection", color: "#F7CAC9", emoji: "üéé" },
      { text: "Book", color: "#92A8D1", emoji: "üìï" },
      { text: "Floof", color: "#955251", emoji: "üêæ" },
      { text: "Self-care Item", color: "#FFB347", emoji: "üíÖ"},
      { text: "View (outdoors/window)", color: "#00CED1", emoji: "üèûÔ∏è"},
      { text: "Art (not by you)", color: "#FF1493", emoji: "üñºÔ∏è" },
      { text: "Seasonal", color: "#7FFF00", emoji: "üß§"},
      { text: "Book", color: "#92A8D1", emoji: "üìï"},
      { text: "Decor", color: "#8A2BE2", emoji: "üõãÔ∏è" },
      { text: "Mystery Item", color: "#FF4500", emoji: "üé≤" },
      { text: "Instrument", color: "#1E90FF", emoji: "üé∫" },
      { text: "Floof", color: "#955251", emoji: "üêæ" },
      { text: "Stuffy", color: "#DAA520", emoji: "üß∏" },
      { text: "Collection", color: "#F7CAC9", emoji: "üéé" },
      { text: "Ta Das!", color: "#20B2AA", emoji: "üéâ" },
      { text: "Collectable/Vintage", color: "#FF69B4", emoji: "ü™ô" },
      { text: "Plant", color: "#32CD32", emoji: "ü™¥" },
      { text: "Fidget", color: "#BA55D3", emoji: "‚öôÔ∏è" },
      { text: "Organization Gadget/Tip", color: "#00FA9A", emoji: "üóÇÔ∏è" },
      { text: "Prized Possession", color: "#FF6347", emoji: "üíé" },
      { text: "Floof", color: "#955251", emoji: "üêæ" },
      { text: "Lego/Puzzle", color: "#88B04B", emoji: "üß©" },
      { text: "Arts/Crafts", color: "#FF6F61", emoji: "üé®" },
      { text: "Current Hyper Fixation", color: "#4682B4", emoji: "üåÄ" },
      { text: "Notebook/Agenda/Calendar", color: "#DA70D6", emoji: "üìù" },
      { text: "View (outdoors/window)", color: "#00CED1", emoji: "üèûÔ∏è" },
      { text: "Stuffy", color: "#DAA520" , emoji: "üß∏"}
    ];

    // Load saved state or initialize
    let segments = localStorage.getItem("segments") ? JSON.parse(localStorage.getItem("segments")) : JSON.parse(JSON.stringify(originalSegments));
    let history = localStorage.getItem("history") ? JSON.parse(localStorage.getItem("history")) : [];
    let currentAngle = 0;
    let isSpinning = false;
    let animationId = null;

    // Disable spin button if wheel is empty
    if (segments.length === 0) {
      document.getElementById("spinBtn").disabled = true;
    }

    function updateDebugStatus(status) {
      document.getElementById("debugStatus").textContent = status;
    }

function drawWheel() {
  const centerX = canvas.width / 2;
  const centerY = canvas.height / 2;
  const radius = 240;          // full wheel size
  const textRadius = 120;      // text goes inside
  const emojiRadius = 220;     // emoji goes outside, near edge

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (segments.length === 0) {
    ctx.fillStyle = "#ddd";
    ctx.beginPath();
    ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
    ctx.fill();
    ctx.fillStyle = "#666";
    ctx.font = "20px Arial";
    ctx.textAlign = "center";
    ctx.fillText("All Done!", centerX, centerY);
    return;
  }

  const segmentAngle = (Math.PI * 2) / segments.length;

  segments.forEach((seg, i) => {
    const start = currentAngle + i * segmentAngle;
    const end = start + segmentAngle;

    // Segment background
    ctx.fillStyle = seg.color;
    ctx.beginPath();
    ctx.moveTo(centerX, centerY);
    ctx.arc(centerX, centerY, radius, start, end);
    ctx.closePath();
    ctx.fill();

    ctx.strokeStyle = "#fff";
    ctx.lineWidth = 2;
    ctx.stroke();

    const textAngle = start + segmentAngle / 2;

    // --- Draw text (inside) ---
    const textX = centerX + Math.cos(textAngle) * textRadius;
    const textY = centerY + Math.sin(textAngle) * textRadius;
    ctx.save();
    ctx.translate(textX, textY);
    ctx.rotate(textAngle);
    ctx.fillStyle = "white";
    ctx.font = "16px Arial";
    ctx.textAlign = "center";
    ctx.fillText(seg.text, 0, 0);
    ctx.restore();

    // --- Draw emoji (outside) ---
    const emojiX = centerX + Math.cos(textAngle) * emojiRadius;
    const emojiY = centerY + Math.sin(textAngle) * emojiRadius;
    ctx.save();
    ctx.translate(emojiX, emojiY);
    ctx.rotate(textAngle);
    ctx.fillStyle = "white";
    ctx.font = "34px Arial"; // good size for edge
    ctx.textAlign = "center";
    ctx.fillText(seg.emoji || "", 0, 0);
    ctx.restore();
  });

  // Pointer
  ctx.fillStyle = "black";
  ctx.beginPath();
  ctx.moveTo(centerX + radius - 10, centerY);
  ctx.lineTo(centerX + radius + 20, centerY - 10);
  ctx.lineTo(centerX + radius + 20, centerY + 10);
  ctx.closePath();
  ctx.fill();
}


    function getSelectedSegment() {
      if (segments.length === 0) return null;
      const normalizedAngle = (((-currentAngle) % (Math.PI*2)) + Math.PI*2) % (Math.PI*2);
      // Offset by -90 degrees (œÄ/2 radians) because pointer is now on the right
      //const normalizedAngle = (((-currentAngle + Math.PI/2) % (Math.PI*2)) + Math.PI*2) % (Math.PI*2);

      const segmentAngle = (Math.PI*2) / segments.length;
      const index = Math.floor(normalizedAngle / segmentAngle);
      return segments[index];
    }

    function spin() {
      if (isSpinning || segments.length === 0) {
        updateDebugStatus("Cannot spin right now");
        return;
      }

      updateDebugStatus("Spinning...");
      isSpinning = true;

      const spins = 5 + Math.random() * 5;
      const finalAngle = spins * Math.PI * 2;
      const startTime = Date.now();
      const duration = 3000;
      const startAngle = currentAngle;

      function animate() {
        const elapsed = Date.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const easeOut = 1 - Math.pow(1 - progress, 3);

        currentAngle = startAngle + finalAngle * easeOut;
        drawWheel();

        if (progress < 1) {
          animationId = requestAnimationFrame(animate);
        } else {
          isSpinning = false;
          const selected = getSelectedSegment();
          if (selected) {
            updateDebugStatus("Spin complete!");

            // Add to history
            history.unshift(selected.text);
            if (history.length > 5) history.pop();
            updateHistory();

            // Remove from wheel and add to spun list
            const idx = segments.indexOf(selected);
            if (idx > -1) {
              segments.splice(idx, 1);
              spunItems.push(selected);
            }
            
            // Save state
            localStorage.setItem("segments", JSON.stringify(segments));
            localStorage.setItem("history", JSON.stringify(history));
            localStorage.setItem("spunItems", JSON.stringify(spunItems));
            
            updateSegmentCount();
            updateLists();

            setTimeout(() => {
              alert("The parade for today is: " + selected.text + " " + (selected.emoji || ""));
              if (segments.length === 0) {
                alert("All prizes have been chosen! üéâ");
                document.getElementById("spinBtn").disabled = true;
                updateDebugStatus("All done!");
              } else {
                updateDebugStatus("Ready to spin again");
              }
              drawWheel();
            }, 100);
          }
        }
      }

      animate();
    }

    function updateHistory() {
      const historyList = document.getElementById("historyList");
      historyList.innerHTML = "";
      history.forEach((item, i) => {
        const li = document.createElement("li");
        li.textContent = `${i+1}. ${item}`;
        historyList.appendChild(li);
      });
    }

    let spunItems = []; // items already spun

function updateLists() {
  const remainingList = document.getElementById("remainingList");
  const spunList = document.getElementById("spunList");

  remainingList.innerHTML = "";
  spunList.innerHTML = "";

  segments.forEach((seg) => {
    const li = document.createElement("li");
    li.textContent = seg.text + " " + (seg.emoji || "");
    li.dataset.text = seg.text;
    li.onclick = () => {
      // Deselect all in Remaining
      [...remainingList.querySelectorAll("li")].forEach(el => el.classList.remove("selected"));
      // Deselect all in Spun to enforce mutual exclusivity
      [...spunList.querySelectorAll("li")].forEach(el => el.classList.remove("selected"));
      li.classList.add("selected");
    };
    remainingList.appendChild(li);
  });

  spunItems.forEach((seg) => {
    const li = document.createElement("li");
    li.textContent = seg.text + " " + (seg.emoji || "");
    li.dataset.text = seg.text;
    li.onclick = () => {
      // Deselect all in Spun
      [...spunList.querySelectorAll("li")].forEach(el => el.classList.remove("selected"));
      // Deselect all in Remaining to enforce mutual exclusivity
      [...remainingList.querySelectorAll("li")].forEach(el => el.classList.remove("selected"));
      li.classList.add("selected");
    };
    spunList.appendChild(li);
  });
}




function moveSelected(direction) {
  const remainingList = document.getElementById("remainingList");
  const spunList = document.getElementById("spunList");

  if (direction === "toSpun") {
    [...remainingList.querySelectorAll(".selected")].forEach(li => {
      const text = li.dataset.text;
      const idx = segments.findIndex(s => s.text === text);
      if (idx > -1) {
        spunItems.push(segments[idx]);
        segments.splice(idx, 1);
      }
    });
  } else if (direction === "toRemaining") {
    [...spunList.querySelectorAll(".selected")].forEach(li => {
      const text = li.textContent.trim().split(" ")[0];
      const idx = spunItems.findIndex(s => s.text === text);
      if (idx > -1) {
        segments.push(spunItems[idx]);
        spunItems.splice(idx, 1);
      }
    });
  }

  updateLists();
  updateSegmentCount();
  drawWheel();

  // save state
  localStorage.setItem("segments", JSON.stringify(segments));
  localStorage.setItem("spunItems", JSON.stringify(spunItems));
}


    function updateSegmentCount() {
      document.getElementById("segmentCount").textContent = segments.length;
    }

function resetWheel() {
  if (animationId) cancelAnimationFrame(animationId);

  // Move all spun items back to wheel
  segments = segments.concat(spunItems);
  spunItems = [];

  currentAngle = 0;
  isSpinning = false;

  document.getElementById("spinBtn").disabled = false;

  // Save state
  localStorage.setItem("segments", JSON.stringify(segments));
  localStorage.setItem("spunItems", JSON.stringify(spunItems));

  updateLists();
  updateSegmentCount();
  updateDebugStatus("Ready to spin");
  drawWheel();
}


    function removePermanently() {
  // Confirm before deleting
  if (!confirm("Are you sure you want to delete the selected item(s)? This can be undone by selecting the button 'Revert Wheel to Original State' or by re-adding the item to the wheel later.")) {
    return;
  }

  const remainingList = document.getElementById("remainingList");
  const spunList = document.getElementById("spunList");

  // Remove from Remaining
  [...remainingList.querySelectorAll(".selected")].forEach(li => {
    const text = li.dataset.text;
    const idx = segments.findIndex(s => s.text === text);
    if (idx > -1) {
      segments.splice(idx, 1);
    }
  });

  // Remove from Spun
  [...spunList.querySelectorAll(".selected")].forEach(li => {
    const text = li.dataset.text;
    const idx = spunItems.findIndex(s => s.text === text);
    if (idx > -1) {
      spunItems.splice(idx, 1);
    }
  });

  updateLists();
  updateSegmentCount();
  drawWheel();

  // save state
  localStorage.setItem("segments", JSON.stringify(segments));
  localStorage.setItem("spunItems", JSON.stringify(spunItems));
}

function revertOriginal() {
  if (!confirm("This will reset the wheel to its original state. Continue?")) return;

  segments = JSON.parse(JSON.stringify(originalSegments));
  spunItems = [];
  history = [];
  currentAngle = 0;

  // Reset localStorage
  localStorage.removeItem("segments");
  localStorage.removeItem("spunItems");
  localStorage.removeItem("history");

  document.getElementById("spinBtn").disabled = false;

  updateLists();
  updateHistory();
  updateSegmentCount();
  drawWheel();
  updateDebugStatus("Wheel reset to original state");
}

    function addNewItem() {
  const text = document.getElementById("newText").value.trim();
  const emoji = document.getElementById("newEmoji").value.trim();
  const color = document.getElementById("newColor").value;

  if (!text) {
    alert("Please enter text for the new item.");
    return;
  }

  const newSegment = { text, emoji, color };

  // Add to wheel
  segments.push(newSegment);

  // Save to localStorage
  localStorage.setItem("segments", JSON.stringify(segments));

  // Update UI
  updateLists();
  updateSegmentCount();
  drawWheel();

  // Clear form
  document.getElementById("newText").value = "";
  document.getElementById("newEmoji").value = "";
  document.getElementById("newColor").value = "#FF0000";

  updateDebugStatus(`Added new item: ${text} ${emoji}`);
}


    // Initialize
    drawWheel();
    updateHistory();
    updateSegmentCount();
    updateDebugStatus("Ready to spin");
    spunItems = localStorage.getItem("spunItems") 
      ? JSON.parse(localStorage.getItem("spunItems")) 
      : [];
    
    updateLists();
    
    document.getElementById("addItemBtn").addEventListener("click", addNewItem);

  </script>
</body>
</html>
